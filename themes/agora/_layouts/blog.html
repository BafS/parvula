<!DOCTYPE html>
<html>

	<?= $this->fetch('includes::head') ?>

	<body>
		<?= $this->fetch('includes::navbar') ?>

		<article class="default" data-editable-background="background" data-editable-text-color="textColor" data-save="page">
			<div class="container full-padded">
				<?php
				use Parvula\Models\Page;

				$i = 0;
				$limit = 10;
				if (isset($page->options, $page->options['limit'])) {
					$limit = $page->options['limit'];
				}

				$children = $page->getChildren();

				if ($children):
					// Order children by date
					usort($children, function (Page $p1, Page $p2) {
						return $p1->getDateTime() < $p2->getDateTime();
					});
					foreach ($children as $child): ?>
						<section>
						<h2 update-text-color=true><a update-text-color=true href="<?= $baseUrl . $child->slug ?>"><?= $child->title ?></a></h2>
						<?php $dt = $child->getDateTime(); ?>
						<h4 class="article-date"><?= $dt->format(DateTime::ISO8601) ?></h4>
						<p><?= $this->excerpt($child->content) ?>...</p>
						</section>
					<?php if (++$i >= $limit) { break; } ?>
					<?php endforeach; ?>
				<?php else: ?>
					<h1 style="text-align: center;">Aucun article pour le moment.</h1>
				<?php endif; ?>
			</div>
		</article>

		<?= $this->fetch('includes::footer') ?>
		<?= $this->fetch('includes::scripts') ?>

		<script>

			document.addEventListener('DOMContentLoaded', function () {

				function pad (n) { return n<10 ? '0'+n : n }

				var lang = window.navigator.userLanguage || window.navigator.language
				if (typeof lang === 'string') {
					lang = lang.toLowerCase()
					if (lang.length > 2) lang = lang.substring(0, 2)
				}

				var dates = document.querySelectorAll('.article-date')
				var l = dates.length
				var i = 0
				for (; i < l; i++) {
					var elDate = dates[i]
					var d = new Date(elDate.innerHTML)
					var output = ''

					if (lang === 'fr') {
						output = pad(d.getDate()) + '.' + pad(d.getMonth()) + '.' + d.getFullYear()
					} else {
						output = pad(d.getMonth()) + '.' + pad(d.getDate()) + '.' + d.getFullYear()
					}

					elDate.innerHTML = output
				}
			})

		</script>
	</body>
</html>
